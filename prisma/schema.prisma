generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Organization {
  id                  String               @id @default(uuid())
  name                String
  slug                String               @unique
  logoUrl             String?              @map("logo_url")
  website             String?
  phone               String?
  address             String?
  isActive            Boolean              @default(true) @map("is_active")
  createdAt           DateTime             @default(now()) @map("created_at")
  updatedAt           DateTime             @updatedAt @map("updated_at")
  planId              Int?
  invites             Invite[]
  listings            Listing[]
  properties          Property[]           @relation("OrganizationToProperty")
  users               OrganizationUser[]
  maintenanceRequests MaintenanceRequest[]
  plan                Plan?                @relation(fields: [planId], references: [id])
  vendors             Vendor[]

  @@index([planId], map: "organizations_planId_fkey")
  @@map("organizations")
}

model User {
  id                 String              @id @default(uuid())
  email              String              @unique
  passwordHash       String              @map("password_hash")
  emailVerified      Boolean             @default(false) @map("email_verified")
  firstName          String?             @map("first_name")
  lastName           String?             @map("last_name")
  phone              String?
  avatarUrl          String?             @map("avatar_url")
  status             UserStatus          @default(ACTIVE)
  lastLoginAt        DateTime?           @map("last_login_at")
  createdAt          DateTime            @default(now()) @map("created_at")
  updatedAt          DateTime            @updatedAt @map("updated_at")
  sentInvites        Invite[]            @relation("UserInvites")
  listings           Listing[]
  tenantApplications Tenantapplication[]
  organizationUsers  OrganizationUser[]
  leases             Lease[]
  vendors            Vendor[]

  @@map("users")
}

model OrganizationUser {
  id                String               @id @default(uuid())
  userId            String               @map("user_id")
  organizationId    String               @map("organization_id")
  role              UserRole
  createdAt         DateTime             @default(now()) @map("created_at")
  adminActions      AdminAction[]        @relation("AdminActionsByAdmin")
  targetActions     AdminAction[]        @relation("AdminActionsTarget")
  managedProperties Property[]
  postedServices    ServiceMarketplace[]
  createdRequests   MaintenanceRequest[] @relation("RequestCreator")
  organization      Organization         @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user              User                 @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, organizationId])
  @@index([organizationId], map: "organization_users_organization_id_fkey")
  @@map("organization_users")
}

model Vendor {
  id             String       @id @default(uuid())
  organizationId String       @map("organization_id")
  userId         String       @map("user_id")
  companyName    String       @map("company_name")
  serviceType    String       @map("service_type")
  phone          String?
  email          String?
  isActive       Boolean      @default(true) @map("is_active")
  createdAt      DateTime     @default(now()) @map("created_at")
  updatedAt      DateTime     @updatedAt @map("updated_at")
  organization   Organization @relation(fields: [organizationId], references: [id])
  user           User         @relation(fields: [userId], references: [id])

  @@unique([organizationId, userId])
  @@index([userId], map: "vendors_user_id_fkey")
  @@map("vendors")
}

model CategoryMarketplace {
  id          String    @id @default(uuid())
  name        String    @unique
  description String?
  createdAt   DateTime  @default(now())
}

model Location {
  id         String     @id @default(uuid())
  name       String
  city       String?
  country    String?
  createdAt  DateTime   @default(now())
  listings   Listing[]
  properties Property[]
}

model ActionType {
  id           String        @id @default(uuid())
  name         String        @unique
  description  String?
  createdAt    DateTime      @default(now())
  adminActions AdminAction[]
}

model Plan {
  id            Int            @id @default(autoincrement())
  name          String
  badge         String?
  monthlyPrice  Float
  yearlyPrice   Float
  description   String?
  gradient      String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime?      @default(now())
  organizations Organization[]
  features      Feature[]      @relation("PlanFeatures")
  sidebarItems  SidebarItem[]  @relation("SidebarItemPlans")
}

model Feature {
  id           Int           @id @default(autoincrement())
  title        String
  description  String?
  category     String?
  createdAt    DateTime      @default(now())
  icon         String?
  isActive     Boolean       @default(true)
  key          String?       @unique
  path         String?
  updatedAt    DateTime?     @default(now())
  sidebarItems SidebarItem[]
  plans        Plan[]        @relation("PlanFeatures")
}

model SidebarItem {
  id          Int      @id @default(autoincrement())
  label       String
  path        String
  icon        String?
  section     String?
  order       Int?
  badge       String?
  description String?
  isActive    Boolean  @default(true)
  isExternal  Boolean  @default(false)
  target      String?
  featureId   Int?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  role        UserRole
  feature     Feature? @relation(fields: [featureId], references: [id])
  plans       Plan[]   @relation("SidebarItemPlans")

  @@index([featureId], map: "SidebarItem_featureId_fkey")
}

model AboutUs {
  id          Int      @id @default(autoincrement())
  section     String
  description String   @db.Text
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now())
}

model Applicant {
  id          Int           @id @default(autoincrement())
  firstName   String
  lastName    String
  email       String        @unique
  resume      String?
  createdAt   DateTime      @default(now())
  Application Application[]
}

model Application {
  id          Int       @id @default(autoincrement())
  jobId       Int
  applicantId Int
  status      String    @default("Pending")
  appliedAt   DateTime  @default(now())
  Applicant   Applicant @relation(fields: [applicantId], references: [id])
  Job         Job       @relation(fields: [jobId], references: [id])

  @@index([applicantId], map: "Application_applicantId_fkey")
  @@index([jobId], map: "Application_jobId_fkey")
}

model CTA {
  id         Int      @id @default(autoincrement())
  page       String
  title      String
  subtitle   String
  buttonText String
  buttonUrl  String
  gradient   String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime
}

model ContactMessage {
  id          Int      @id @default(autoincrement())
  name        String
  email       String
  message     String
  createdAt   DateTime @default(now())
  countryCode String
  phone       String
}

model HeroSection {
  id          Int      @id @default(autoincrement())
  page        String
  title       String?
  subtitle    String?
  description String?
  buttonText  String?
  buttonUrl   String?
  imageUrl    String?
  iconUrl     String?
  searchBar   Boolean  @default(false)
  gradient    String?
  layout      String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime
}

model Job {
  id          Int           @id @default(autoincrement())
  title       String
  description String
  image       String
  createdAt   DateTime      @default(now())
  updatedAt   DateTime
  Application Application[]
}

model Policy {
  id                       Int       @id @default(autoincrement())
  title                    String
  companyName              String
  contactEmail             String
  privacyEmail             String
  website                  String?
  mailingAddress           String?
  responseTime             String?
  inactiveAccountThreshold String?
  createdAt                DateTime  @default(now())
  updatedAt                DateTime
  Section                  Section[]
}

model Section {
  id        Int      @id @default(autoincrement())
  key       String
  title     String
  intro     String?
  content   Json?
  order     Int?
  policyId  Int
  createdAt DateTime @default(now())
  updatedAt DateTime
  Policy    Policy   @relation(fields: [policyId], references: [id])

  @@index([policyId], map: "Section_policyId_fkey")
}

model Testimonial {
  id        Int      @id @default(autoincrement())
  name      String
  role      String
  image     String
  text      String
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
}

model categories {
  id       Int        @id @default(autoincrement())
  name     String
  tagline  String
  color    String
  services services[]
}

model services {
  id          Int        @id @default(autoincrement())
  category_id Int
  name        String
  description String
  features    Json
  impact      String
  icon        String
  categories  categories @relation(fields: [category_id], references: [id])

  @@index([category_id], map: "services_category_id_fkey")
}

enum UserRole {
  SYSTEM_ADMIN
  PROPERTY_MANAGER
  TENANT
  VENDOR
  ALL
}

enum Priority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum RequestStatus {
  OPEN
  IN_PROGRESS
  ON_HOLD
  COMPLETED
  CANCELLED
}

enum RequestCategory {
  EMERGENCY
  URGENT
  ROUTINE
  STANDARD
}

model MaintenanceRequest {
  id             String        @id @default(uuid())
  organizationId String
  propertyId     String
  requestedById  String
  title          String
  description    String
  unitId         String?
  priority       Priority      @default(NORMAL)
  category       RequestCategory @default(STANDARD)
  status         RequestStatus @default(OPEN)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  organization Organization     @relation(fields: [organizationId], references: [id])
  property     Property         @relation("PropertyMaintenanceRequests", fields: [propertyId], references: [id])
  requestedBy  OrganizationUser @relation("RequestCreator", fields: [requestedById], references: [id])
  unit         Unit?            @relation(fields: [unitId], references: [id])

  @@index([organizationId], map: "MaintenanceRequest_organizationId_fkey")
  @@index([propertyId], map: "MaintenanceRequest_propertyId_fkey")
  @@index([requestedById], map: "MaintenanceRequest_requestedById_fkey")
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

// ---------------------------------------
// MARKETPLACE LISTINGS
// ---------------------------------------



model ListingStatus {
  id          String    @id @default(uuid())
  name        String    @unique // e.g., Pending, Approved, Active, Rejected, Deleted
  description String?
  createdAt   DateTime  @default(now())
  listings    Listing[]
}

model PropertyType {
  id          String     @id @default(uuid())
  name        String     @unique // e.g., Apartment, House, Land, Commercial
  description String?
  createdAt   DateTime   @default(now())
  properties  Property[]
}

model ServiceType {
  id                 String               @id @default(uuid())
  name               String               @unique // e.g., Plumbing, Cleaning, Electrical
  description        String?
  createdAt          DateTime             @default(now())
  serviceMarketplace ServiceMarketplace[]
}

model Listing {
  id             String   @id @default(uuid())
  organizationId String
  createdBy      String
  
  statusId       String?
  locationId     String?
  propertyId     String? // optional, FK lives in Property
  unitId         String? // optional, FK lives in Unit
  title          String
  description    String
  price          Float
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  //  Relations
  organization        Organization        @relation(fields: [organizationId], references: [id])
  createdByUser       User                @relation(fields: [createdBy], references: [id])
  status              ListingStatus?      @relation(fields: [statusId], references: [id])
  location            Location?           @relation(fields: [locationId], references: [id])

  property Property? @relation("PropertyListing")
  unit     Unit?     @relation("UnitListing")

  serviceMarketplace ServiceMarketplace?
  images             ListingImage[]
  adminActions       AdminAction[]
}

model Property {
  id                 String   @id @default(uuid())
  listingId          String?  @unique // FK defined here
  managerId          String?
  name               String?
  organizationId     String?
  propertyTypeId     String?
  locationId         String?
  city               String
  address            String
  amenities          String?
  isFurnished        Boolean  @default(false)
  availabilityStatus String?
  createdAt          DateTime @default(now())

  // ðŸ”— Relations
  listing             Listing?             @relation("PropertyListing", fields: [listingId], references: [id])
  manager             OrganizationUser?    @relation(fields: [managerId], references: [id])
  organization        Organization?        @relation("OrganizationToProperty", fields: [organizationId], references: [id])
  propertyType        PropertyType?        @relation(fields: [propertyTypeId], references: [id])
  location            Location?            @relation(fields: [locationId], references: [id])
  tenantapplications  Tenantapplication[]
  leases              Lease[]
  maintenanceRequests MaintenanceRequest[] @relation("PropertyMaintenanceRequests")

  apartmentComplexDetail ApartmentComplexDetail?
  houseDetail            HouseDetail?

  units Unit[]
}

model ApartmentComplexDetail {
  id           String   @id @default(uuid())
  propertyId   String   @unique
  buildingName String?
  totalFloors  Int?
  totalUnits   Int?
  property     Property @relation(fields: [propertyId], references: [id])
}

model HouseDetail {
  id             String   @id @default(uuid())
  propertyId     String   @unique
  size           Float?
  numberOfFloors Int?
  bedrooms       Int?
  bathrooms      Int?
  totalUnits     Int?
  property       Property @relation(fields: [propertyId], references: [id])
}

model Unit {
  id              String   @id @default(uuid())
  propertyId      String
  complexDetailId String?
  houseDetailId   String?
  listingId       String?  @unique
  unitNumber      String
  floorNumber     Int?
  bedrooms        Int?
  bathrooms       Int?
  isOccupied      Boolean  @default(false)
  rentAmount      Float?
  unitName        String?
  createdAt       DateTime @default(now())

  property Property @relation(fields: [propertyId], references: [id])

  listing            Listing?            @relation("UnitListing", fields: [listingId], references: [id])
  tenantApplications Tenantapplication[]
  leases             Lease[]
  // Many-to-many with Appliance
  appliances         Appliance[]         @relation("UnitAppliances")
  maintenanceRequests MaintenanceRequest[]
}

model Appliance {
  id          String     @id @default(uuid())
  name        String
  description String?
  createdAt   DateTime   @default(now())
  //  Many-to-many back relation
  units       Unit[]     @relation("UnitAppliances")
}

model ServiceMarketplace {
  id            String   @id @default(uuid())
  listingId     String   @unique
  vendorId      String?
  serviceTypeId String?
  description   String
  rate          Float
  availability  String?
  createdAt     DateTime @default(now())

  listing     Listing           @relation(fields: [listingId], references: [id])
  vendor      OrganizationUser? @relation(fields: [vendorId], references: [id])
  serviceType ServiceType?      @relation(fields: [serviceTypeId], references: [id])
}

// ---------------------------------------
// SUPPORTING TABLES
// ---------------------------------------

model ListingImage {
  id        String   @id @default(uuid())
  listingId String
  imageUrl  String
  isPrimary Boolean  @default(false)
  createdAt DateTime @default(now())

  listing Listing @relation(fields: [listingId], references: [id])
}

model AdminAction {
  id              String   @id @default(uuid())
  adminOrgUserId  String
  targetOrgUserId String?
  listingId       String?
  actionTypeId    String
  reason          String?
  details         Json?
  createdAt       DateTime @default(now())

  admin      OrganizationUser  @relation("AdminActionsByAdmin", fields: [adminOrgUserId], references: [id])
  target     OrganizationUser? @relation("AdminActionsTarget", fields: [targetOrgUserId], references: [id])
  listing    Listing?          @relation(fields: [listingId], references: [id])
  actionType ActionType        @relation(fields: [actionTypeId], references: [id])
}

model NavbarItem {
  id          Int      @id @default(autoincrement())
  name        String
  href        String
  order       Int      @default(0)
  isVisible   Boolean  @default(true)
  isAvailable Boolean  @default(true)
  parentId    Int? // New: nullable parent reference
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  parent   NavbarItem?  @relation("NavbarSubmenu", fields: [parentId], references: [id], onDelete: Cascade)
  children NavbarItem[] @relation("NavbarSubmenu")

  @@index([parentId])
  @@index([order])
}

model Invite {
  id             String       @id @default(cuid())
  email          String
  token          String       @unique
  role           UserRole
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])
  invitedById    String?
  invitedBy      User?        @relation("UserInvites", fields: [invitedById], references: [id])
  expiresAt      DateTime
  accepted       Boolean      @default(false)
  createdAt      DateTime     @default(now())

  @@index([organizationId])
  @@index([email])
}

//-----------------------
// tenant application 
//------------------------
model Tenantapplication {
  id                 String            @id @default(uuid())
  fullName           String
  email              String
  phone              String
  dob                DateTime
  ssn                String?
  address            String?
  employerName       String?
  jobTitle           String?
  monthlyIncome      Float?
  employmentDuration String?
  leaseType          String
  occupancyType      String
  moveInDate         DateTime
  leaseDuration      String
  occupants          Int?
  pets               String?
  landlordName       String?
  landlordContact    String?
  reasonForMoving    String?
  referenceName      String?
  referenceContact   String?
  consent            Boolean           @default(false)
  propertyId         String
  userId             String?
  status             ApplicationStatus @default(PENDING)
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt
  property           Property          @relation(fields: [propertyId], references: [id])
  user               User?             @relation(fields: [userId], references: [id])

  unitId       String?
  unit         Unit?   @relation(fields: [unitId], references: [id])
  tenantLeases Lease[]

  @@index([propertyId], map: "Tenantapplication_propertyId_fkey")
  @@index([userId], map: "Tenantapplication_userId_fkey")
}

enum ApplicationStatus {
  PENDING
  APPROVED
  REJECTED
  UNDER_REVIEW
}

//----------------
// lease
//----------------
model Lease {
  id            String @id @default(uuid())
  applicationId String @unique
  tenantId      String?
  propertyId    String
  unitId        String

  // Lease Term
  startDate     DateTime
  endDate       DateTime
  leaseTerm     String? // "12 months", "6 months", "Month-to-month"

  // Payment Terms
  rentAmount        Float
  paymentDueDay     Int?        // 1â€“31
  paymentFrequency  String      @default("MONTHLY") // MONTHLY / WEEKLY

  // Security Deposit
  securityDeposit   Float?

  // Late Fees & Penalties
  lateFeeFlat       Float?
  lateFeeDaily      Float?
  gracePeriodDays   Int?        // Allowed late days before fees apply

  // Maintenance & Responsibilities
  landlordResponsibilities String? // summarized responsibilities
  tenantResponsibilities   String? // summarized responsibilities

  // Utilities
  tenantPaysElectric Boolean @default(true)
  tenantPaysWater    Boolean @default(false)
  tenantPaysTrash    Boolean @default(false)
  tenantPaysInternet Boolean @default(false)

  // Usage Clause
  usageType       String?  // "Residential" (default), "Commercial", etc.

  // Termination
  earlyTerminationFee Float?
  terminationNoticeDays Int? // 30 days notice, for example

  // Lease Lifecycle
  leaseStatus LeaseStatus @default(DRAFT)

  // Signatures
  tenantSignedAt   DateTime?
  landlordSignedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  application Tenantapplication @relation(fields: [applicationId], references: [id])
  tenant   User? @relation(fields: [tenantId], references: [id])
  property    Property          @relation(fields: [propertyId], references: [id])
  unit        Unit              @relation(fields: [unitId], references: [id])
}


enum LeaseStatus {
  DRAFT
  ACTIVE
  SIGNED
  CANCELLED
}
