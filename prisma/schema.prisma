generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model AboutUs {
  id          Int      @id @default(autoincrement())
  section     String
  description String   @db.Text
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now())
}

model ActionType {
  id           String        @id
  name         String        @unique
  description  String?
  createdAt    DateTime      @default(now())
  adminActions AdminAction[]

  @@map("ActionType")
}

model AdminAction {
  id              String   @id @default(uuid())
  adminOrgUserId  String   @map("adminOrgUserId")
  targetOrgUserId String?  @map("targetOrgUserId")
  listingId       String?  @map("listingId")
  actionTypeId    String   @map("actionTypeId")
  reason          String?  @db.Text
  details         Json?
  createdAt       DateTime @default(now()) @map("createdAt")

  actionType    ActionType        @relation(fields: [actionTypeId], references: [id])
  adminOrgUser  OrganizationUser  @relation("AdminAction_adminOrgUserIdToOrganizationUser", fields: [adminOrgUserId], references: [id])
  listing       Listing?          @relation(fields: [listingId], references: [id])
  targetOrgUser OrganizationUser? @relation("AdminAction_targetOrgUserIdToOrganizationUser", fields: [targetOrgUserId], references: [id])

  @@index([actionTypeId], map: "AdminAction_actionTypeId_fkey")
  @@index([adminOrgUserId], map: "AdminAction_adminOrgUserId_fkey")
  @@index([listingId], map: "AdminAction_listingId_fkey")
  @@index([targetOrgUserId], map: "AdminAction_targetOrgUserId_fkey")
  @@map("AdminAction")
}

model ApartmentComplexDetail {
  id           String   @id @default(uuid())
  propertyId   String   @unique
  buildingName String?
  totalFloors  Int?
  totalUnits   Int?
  Property     Property @relation(fields: [propertyId], references: [id])
}

model Appliance {
  id          String   @id @default(uuid())
  createdAt   DateTime @default(now())
  description String?
  name        String
  units       Unit[]   @relation("UnitAppliances")
}

model Applicant {
  id          Int           @id @default(autoincrement())
  firstName   String
  lastName    String
  email       String        @unique
  resume      String?
  createdAt   DateTime      @default(now())
  Application Application[]
}

model Application {
  id          Int       @id @default(autoincrement())
  jobId       Int
  applicantId Int
  status      String    @default("Pending")
  appliedAt   DateTime  @default(now())
  Applicant   Applicant @relation(fields: [applicantId], references: [id])
  Job         Job       @relation(fields: [jobId], references: [id])

  @@index([applicantId], map: "Application_applicantId_fkey")
  @@index([jobId], map: "Application_jobId_fkey")
}

model CTA {
  id         Int      @id @default(autoincrement())
  page       String
  title      String
  subtitle   String
  buttonText String
  buttonUrl  String
  gradient   String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @default(now()) @updatedAt
}

model CategoryMarketplace {
  id          String   @id
  name        String   @unique
  description String?
  createdAt   DateTime @default(now())
}

model ContactMessage {
  id          Int      @id @default(autoincrement())
  name        String
  email       String
  message     String
  createdAt   DateTime @default(now())
  countryCode String
  phone       String
}

model Feature {
  id           Int           @id @default(autoincrement())
  title        String
  description  String?
  category     String?
  createdAt    DateTime      @default(now())
  icon         String?
  isActive     Boolean       @default(true)
  key          String?       @unique
  path         String?
  updatedAt    DateTime?     @default(now())
  sidebarItems SidebarItem[]
  plans        Plan[]        @relation("PlanFeatures")

  @@map("Feature")
}

model HeroSection {
  id          Int      @id @default(autoincrement())
  page        String
  title       String?
  subtitle    String?
  description String?
  buttonText  String?
  buttonUrl   String?
  imageUrl    String?
  iconUrl     String?
  searchBar   Boolean  @default(false)
  gradient    String?
  layout      String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime
}

model HouseDetail {
  id             String   @id @default(uuid())
  propertyId     String   @unique
  numberOfFloors Int?
  bathrooms      Int?
  bedrooms       Int?
  size           Float?
  totalUnits     Int?
  houseName      String?  @db.VarChar(255)
  Property       Property @relation(fields: [propertyId], references: [id])
}

model Invite {
  id             String   @id @default(uuid())
  email          String
  token          String   @unique
  role           UserRole
  organizationId String   @map("organization_id")
  invitedById    String?  @map("invited_by_id")
  expiresAt      DateTime @map("expires_at")
  accepted       Boolean  @default(false)
  createdAt      DateTime @default(now()) @map("created_at")
  leaseId        String?  @map("lease_id") @db.VarChar(255)

  lease        Lease?       @relation(fields: [leaseId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "FK_Invite_Lease")
  invitedBy    User?        @relation(fields: [invitedById], references: [id])
  organization Organization @relation(fields: [organizationId], references: [id])

  @@index([email])
  @@index([invitedById], map: "Invite_invitedById_fkey")
  @@index([organizationId])
  @@index([leaseId], map: "idx_invite_leaseId")
  @@map("Invite")
}

model InvoiceItem {
  id          String    @id @default(dbgenerated("(uuid())")) @db.Char(36)
  invoiceId   String    @db.Char(36)
  description String    @db.VarChar(255)
  amount      Float
  createdAt   DateTime? @default(now()) @db.DateTime(0)
  updatedAt   DateTime? @default(now()) @db.DateTime(0)
  invoice     Invoice   @relation(fields: [invoiceId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "InvoiceItem_ibfk_1")

  @@index([invoiceId], map: "invoiceId")
}

model Job {
  id          Int           @id @default(autoincrement())
  title       String
  description String
  image       String
  createdAt   DateTime      @default(now())
  updatedAt   DateTime
  Application Application[]
}

model Lease {
  id                       String                 @id @default(uuid())
  applicationId            String                 @unique @map("application_id")
  tenantId                 String?                @map("tenant_id")
  propertyId               String                 @map("property_id")
  unitId                   String                 @map("unit_id")
  startDate                DateTime               @map("start_date")
  endDate                  DateTime               @map("end_date")
  rentAmount               Float                  @map("rent_amount")
  securityDeposit          Float?                 @map("security_deposit")
  status                   LeaseStatus?           @default(DRAFT) @map("lease_status")
  createdAt                DateTime               @default(now()) @map("created_at")
  updatedAt                DateTime               @updatedAt @map("updated_at")
  earlyTerminationFee      Float?                 @map("early_termination_fee")
  gracePeriodDays          Int?                   @map("grace_period_days")
  landlordResponsibilities String?                @map("landlord_responsibilities") @db.Text
  landlordSignedAt         DateTime?              @map("landlord_signed_at")
  lateFeeDaily             Float?                 @map("late_fee_daily")
  lateFeeFlat              Float?                 @map("late_fee_flat")
  leaseTerm                String?                @map("lease_term")
  paymentDueDay            Int?                   @map("payment_due_day")
  paymentFrequency         String                 @default("MONTHLY") @map("payment_frequency")
  tenantPaysElectric       Boolean                @default(true) @map("tenant_pays_electric")
  tenantPaysInternet       Boolean                @default(false) @map("tenant_pays_internet")
  tenantPaysTrash          Boolean                @default(false) @map("tenant_pays_trash")
  tenantPaysWater          Boolean                @default(false) @map("tenant_pays_water")
  tenantResponsibilities   String?                @map("tenant_responsibilities") @db.Text
  tenantSignedAt           DateTime?              @map("tenant_signed_at")
  terminationNoticeDays    Int?                   @map("termination_notice_days")
  usageType                String?                @map("usage_type")
  autoRenew                Boolean?               @default(false) @map("auto_renew")
  complianceCheckDate      DateTime?              @map("compliance_check_date") @db.DateTime(0)
  complianceNotes          String?                @map("compliance_notes") @db.Text
  complianceStatus         LeaseComplianceStatus? @default(PENDING) @map("compliance_status")
  documentVersion          Int?                   @default(1) @map("document_version")
  escalationFrequency      String?                @map("escalation_frequency") @db.VarChar(20)
  escalationRate           Float?                 @map("escalation_rate") @db.Float
  escalationType           RentEscalationType?    @map("escalation_type")
  hasRenewalOption         Boolean?               @default(false) @map("has_renewal_option")
  hasRentEscalation        Boolean?               @default(false) @map("has_rent_escalation")
  lastDocumentUpdate       DateTime?              @map("last_document_update") @db.DateTime(0)
  nextEscalationDate       DateTime?              @map("next_escalation_date") @db.DateTime(0)
  renewalNoticeDays        Int?                   @map("renewal_notice_days")
  renewalRentIncrease      Float?                 @map("renewal_rent_increase") @db.Float
  renewalTermMonths        Int?                   @map("renewal_term_months")

  invites           Invite[]
  tenantApplication TenantApplication   @relation(fields: [applicationId], references: [id])
  property          Property            @relation(fields: [propertyId], references: [id])
  tenant            User?               @relation(fields: [tenantId], references: [id])
  unit              Unit                @relation(fields: [unitId], references: [id])
  amendments        LeaseAmendment[]
  auditLogs         LeaseAuditLog[]
  documents         LeaseDocument[]
  notifications     LeaseNotification[]
  renewals          LeaseRenewal[]
  rentEscalations   RentEscalation[]
  dssDocuments      DssDocument[]
  invoices          Invoice[]
  leaseUtilities    LeaseUtility[]

  @@index([propertyId], map: "Lease_propertyId_fkey")
  @@index([tenantId], map: "Lease_tenantId_fkey")
  @@index([unitId], map: "Lease_unitId_fkey")
  @@index([endDate], map: "idx_lease_endDate")
  @@index([status], map: "idx_leaseStatus")
  @@map("Lease")
}

model LeaseAmendment {
  id             String                @id @default(uuid())
  leaseId        String                @map("lease_id")
  type           LeaseAmendmentType    @map("amendment_type")
  effectiveDate  DateTime              @map("effective_date") @db.DateTime(0)
  description    String?               @map("description") @db.Text
  changes        Json?
  previousValues Json?                 @map("previous_values")
  status         LeaseAmendmentStatus? @default(PENDING)
  createdBy      String                @map("created_by")
  createdAt      DateTime?             @default(now()) @map("created_at") @db.DateTime(0)
  approvedBy     String?               @map("approved_by")
  approvedAt     DateTime?             @map("approved_at") @db.DateTime(0)
  executedBy     String?               @map("executed_by")
  executedAt     DateTime?             @map("executed_at") @db.DateTime(0)
  documentUrl    String?               @map("document_url") @db.Text

  lease Lease @relation(fields: [leaseId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "LeaseAmendment_ibfk_1")

  @@index([leaseId], map: "idx_leaseAmendment_leaseId")
  @@index([status], map: "idx_leaseAmendmentStatus")
  @@map("LeaseAmendment")
}

model LeaseAuditLog {
  id          String    @id
  leaseId     String
  action      String    @db.Text
  performedBy String
  performedAt DateTime? @default(now()) @db.DateTime(0)
  changes     Json?
  ipAddress   String?   @db.VarChar(50)
  userAgent   String?   @db.Text
  Lease       Lease     @relation(fields: [leaseId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "LeaseAuditLog_ibfk_1")

  @@index([leaseId], map: "idx_leaseAuditLog_leaseId")
  @@index([performedAt], map: "idx_leaseAuditLog_performedAt")
}

model LeaseDocument {
  id           String            @id
  leaseId      String
  documentType LeaseDocumentType
  fileName     String            @db.Text
  fileUrl      String            @db.Text
  fileSize     Int?
  mimeType     String?           @db.Text
  version      Int?              @default(1)
  uploadedBy   String
  uploadedAt   DateTime?         @default(now()) @db.DateTime(0)
  isSigned     Boolean?          @default(false)
  signedAt     DateTime?         @db.DateTime(0)
  description  String?           @db.Text
  Lease        Lease             @relation(fields: [leaseId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "LeaseDocument_ibfk_1")

  @@index([documentType], map: "idx_leaseDocument_documentType")
  @@index([leaseId], map: "idx_leaseDocument_leaseId")
}

model LeaseNotification {
  id               String                   @id
  leaseId          String
  notificationType LeaseNotificationType
  recipientEmail   String
  recipientRole    String?                  @db.VarChar(20)
  subject          String?                  @db.Text
  message          String?                  @db.Text
  scheduledFor     DateTime                 @db.DateTime(0)
  sentAt           DateTime?                @db.DateTime(0)
  status           LeaseNotificationStatus? @default(PENDING)
  metadata         Json?
  createdAt        DateTime?                @default(now()) @db.DateTime(0)
  lease            Lease                    @relation(fields: [leaseId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "LeaseNotification_ibfk_1")

  @@index([leaseId], map: "idx_leaseNotification_leaseId")
  @@index([scheduledFor], map: "idx_leaseNotification_scheduledFor")
  @@index([status], map: "idx_leaseNotification_status")
}

model LeaseRenewal {
  id                 String              @id
  leaseId            String
  renewalType        LeaseRenewalType
  oldEndDate         DateTime            @db.DateTime(0)
  newEndDate         DateTime            @db.DateTime(0)
  oldRentAmount      Float               @db.Float
  newRentAmount      Float               @db.Float
  notificationSentAt DateTime?           @db.DateTime(0)
  tenantResponseAt   DateTime?           @db.DateTime(0)
  tenantResponse     TenantResponse?
  negotiationNotes   String?             @db.Text
  executedAt         DateTime?           @db.DateTime(0)
  executedBy         String?
  status             LeaseRenewalStatus? @default(PENDING)
  createdAt          DateTime?           @default(now()) @db.DateTime(0)
  lease              Lease               @relation(fields: [leaseId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "LeaseRenewal_ibfk_1")

  @@index([leaseId], map: "idx_leaseRenewal_leaseId")
  @@index([status], map: "idx_leaseRenewal_status")
}

model Listing {
  id             String   @id @default(uuid())
  organizationId String   @map("organization_id") // Added map
  createdBy      String   @map("created_by") // Added map
  statusId       String?  @map("status_id") // Added map
  locationId     String?  @map("location_id") // Added map
  title          String
  description    String
  price          Float
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  propertyId String? @map("property_id") // Added map
  unitId     String? @map("unit_id") // Added map

  adminActions       AdminAction[]
  createdByUser      User                @relation(fields: [createdBy], references: [id])
  location           Location?           @relation(fields: [locationId], references: [id])
  organization       Organization        @relation(fields: [organizationId], references: [id])
  status             ListingStatus?      @relation(fields: [statusId], references: [id])
  images             ListingImage[]
  property           Property?           @relation("PropertyListing")
  serviceMarketplace ServiceMarketplace?
  unit               Unit?               @relation("UnitListing")

  @@index([createdBy], map: "Listing_createdBy_fkey")
  @@index([locationId], map: "Listing_locationId_fkey")
  @@index([organizationId], map: "Listing_organizationId_fkey")
  @@index([statusId], map: "Listing_statusId_fkey")
  @@map("listings") // Ensure table name is mapped if needed (optional but good practice)
}

model ListingImage {
  id        String   @id
  listingId String
  imageUrl  String
  isPrimary Boolean  @default(false)
  createdAt DateTime @default(now())
  Listing   Listing  @relation(fields: [listingId], references: [id])

  @@index([listingId], map: "ListingImage_listingId_fkey")
}

model ListingStatus {
  id          String    @id
  name        String    @unique
  description String?
  createdAt   DateTime  @default(now())
  Listing     Listing[]
}

model Location {
  id        String     @id @default(uuid())
  name      String
  city      String?
  country   String?
  createdAt DateTime   @default(now())
  Listing   Listing[]
  Property  Property[]
}

model MaintenanceRequest {
  id                 String                    @id @default(uuid())
  organizationId     String
  propertyId         String
  requestedById      String
  title              String
  description        String
  priority           MaintenancePriority       @default(NORMAL)
  status             MaintenanceStatus         @default(OPEN)
  createdAt          DateTime                  @default(now())
  updatedAt          DateTime                  @updatedAt
  category           MaintenanceCategory       @default(STANDARD)
  unitId             String?
  cost               Decimal?                  @db.Decimal(10, 2)

  // ✅ FIX: Use camelCase for field name, map to snake_case column
  assignedAt         DateTime?                 @map("assigned_at") @db.DateTime(0)
  assignedVendorId   String?                   @map("assigned_vendor_id")

  // Relations
  organization       Organization              @relation(fields: [organizationId], references: [id])
  property           Property                  @relation(fields: [propertyId], references: [id])
  requestedBy        OrganizationUser          @relation("RequestCreator", fields: [requestedById], references: [id])
  unit               Unit?                     @relation(fields: [unitId], references: [id])

  // ✅ FIX: Relation uses the camelCase field name
  vendors            Vendor?                   @relation(fields: [assignedVendorId], references: [id], onUpdate: NoAction, map: "fk_MaintenanceRequest_assignedVendorId")

  @@index([organizationId], map: "MaintenanceRequest_organizationId_fkey")
  @@index([propertyId], map: "MaintenanceRequest_propertyId_fkey")
  @@index([requestedById], map: "MaintenanceRequest_requestedById_fkey")
  @@index([unitId], map: "MaintenanceRequest_unitId_fkey")
  @@index([assignedVendorId], map: "MaintenanceRequest_assignedVendorId_fkey")
}

model NavbarItem {
  id          Int          @id @default(autoincrement())
  name        String
  href        String
  order       Int          @default(0)
  isVisible   Boolean      @default(true)
  isAvailable Boolean      @default(true)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @default(now()) @updatedAt
  parentId    Int?
  parent      NavbarItem?  @relation("NavbarItemToNavbarItem", fields: [parentId], references: [id], onDelete: Cascade)
  children    NavbarItem[] @relation("NavbarItemToNavbarItem")

  @@index([order])
  @@index([parentId])
}

model OccupancyHistory {
  id            String   @id @default(uuid())
  propertyId    String
  year          Int
  month         Int
  occupancyRate Decimal  @db.Decimal(5, 2)
  createdAt     DateTime @default(now())
  Property      Property @relation(fields: [propertyId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_occupancy_property")

  @@index([propertyId, year, month], map: "idx_occupancy_property_year_month")
}

model PasswordResetToken {
  id        String   @id @default(uuid())
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Plan {
  id           Int            @id @default(autoincrement())
  name         String
  badge        String?
  monthlyPrice Float
  yearlyPrice  Float
  description  String?
  gradient     String?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime?      @default(now())
  organization Organization[]
  features     Feature[]      @relation("PlanFeatures")
  sidebarItems SidebarItem[]  @relation("SidebarItemPlans")

  @@map("Plan")
}

model Policy {
  id                       Int       @id @default(autoincrement())
  title                    String
  companyName              String
  contactEmail             String
  privacyEmail             String
  website                  String?
  mailingAddress           String?
  responseTime             String?
  inactiveAccountThreshold String?
  createdAt                DateTime  @default(now())
  updatedAt                DateTime
  contactPhone             String?
  contactEmailLabel        String?
  contactPhoneLabel        String?
  Section                  Section[]
}

model Property {
  id                 String   @id @default(uuid())
  listingId          String?  @unique @map("listing_id")
  managerId          String?  @map("manager_id")
  organizationId     String?  @map("organization_id")
  propertyTypeId     String?  @map("property_type_id")
  locationId         String?  @map("location_id")
  city               String
  address            String
  amenities          String?
  isFurnished        Boolean  @default(false) @map("is_furnished")
  availabilityStatus String?  @map("availability_status")
  createdAt          DateTime @default(now()) @map("created_at")
  name               String?

  // Relations
  apartmentComplexDetail ApartmentComplexDetail?
  houseDetail            HouseDetail?
  leases                 Lease[]
  maintenanceRequests    MaintenanceRequest[]
  occupancyHistory       OccupancyHistory[]
  listing                Listing?                @relation("PropertyListing", fields: [listingId], references: [id])
  location               Location?               @relation(fields: [locationId], references: [id])
  manager                OrganizationUser?       @relation(fields: [managerId], references: [id])
  organization           Organization?           @relation("OrganizationToProperty", fields: [organizationId], references: [id])
  propertyType           PropertyType?           @relation(fields: [propertyTypeId], references: [id])
  images                 PropertyImage[]
  tenantApplications     TenantApplication[]
  units                  Unit[]
  dssDocuments           DssDocument[]
  dssWorkflowTemplates   DssWorkflowTemplate[]

  // --- LEGACY FIELDS (DEPRECATED) ---
  /// @deprecated [Legacy] Use 'manager.email' or 'organization.email' instead.
  contactEmail String? @map("contact_email")
  /// @deprecated [Legacy] Use 'manager.phone' or 'organization.phone' instead.
  contactPhone String? @map("contact_phone")
  /// @deprecated [Legacy] Use the 'Location' relation.
  country      String?
  /// @deprecated [Legacy] Use the 'Location' relation.
  zipCode      String? @map("zip_code")
  /// @deprecated [Legacy] Use the 'Location' relation.
  latitude     Float?
  /// @deprecated [Legacy] Use the 'Location' relation.
  longitude    Float?

  @@index([locationId], map: "Property_locationId_fkey")
  @@index([managerId], map: "Property_managerId_fkey")
  @@index([organizationId], map: "Property_organizationId_fkey")
  @@index([propertyTypeId], map: "Property_propertyTypeId_fkey")
  @@map("Property")
}

model PropertyImage {
  id         String   @id @default(uuid())
  propertyId String   @map("property_id")
  url        String
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  /// @deprecated [Legacy]
  format   String?
  /// @deprecated [Legacy]
  height   Int?
  /// @deprecated [Legacy]
  order    Int?
  /// @deprecated [Legacy]
  publicId String? @map("publicId")
  /// @deprecated [Legacy]
  width    Int?

  property Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@index([propertyId])
  @@map("PropertyImage")
}

model PropertyType {
  id          String     @id
  name        String     @unique
  description String?
  createdAt   DateTime   @default(now())
  Property    Property[]
}

model RentEscalation {
  id              String             @id
  leaseId         String
  effectiveDate   DateTime           @db.DateTime(0)
  previousRent    Float              @db.Float
  newRent         Float              @db.Float
  escalationType  RentEscalationType
  escalationRate  Float?             @db.Float
  calculationNote String?            @db.Text
  appliedAt       DateTime?          @default(now()) @db.DateTime(0)
  appliedBy       String
  lease           Lease              @relation(fields: [leaseId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "RentEscalation_ibfk_1")

  @@index([effectiveDate], map: "idx_rentEscalation_effectiveDate")
  @@index([leaseId], map: "idx_rentEscalation_leaseId")
}

model Section {
  id        Int      @id @default(autoincrement())
  key       String
  title     String
  intro     String?
  content   Json?
  order     Int?
  policyId  Int
  createdAt DateTime @default(now())
  updatedAt DateTime
  Policy    Policy   @relation(fields: [policyId], references: [id])

  @@index([policyId], map: "Section_policyId_fkey")
}

model ServiceMarketplace {
  id            String   @id @default(uuid())
  listingId     String   @unique @map("listing_id")
  vendorId      String?  @map("vendor_id")
  serviceTypeId String?  @map("service_type_id")
  description   String   @db.Text
  rate          Float
  availability  String?
  createdAt     DateTime @default(now()) @map("created_at")

  listing     Listing           @relation(fields: [listingId], references: [id])
  serviceType ServiceType?      @relation(fields: [serviceTypeId], references: [id])
  vendor      OrganizationUser? @relation(fields: [vendorId], references: [id])

  @@index([serviceTypeId], map: "ServiceMarketplace_serviceTypeId_fkey")
  @@index([vendorId], map: "ServiceMarketplace_vendorId_fkey")
  @@map("ServiceMarketplace")
}

model ServiceType {
  id                 String               @id
  name               String               @unique
  description        String?
  createdAt          DateTime             @default(now())
  ServiceMarketplace ServiceMarketplace[]
}

model SidebarItem {
  id          Int      @id @default(autoincrement())
  label       String
  path        String
  icon        String?
  section     String?
  order       Int?
  badge       String?
  description String?
  isActive    Boolean  @default(true)
  isExternal  Boolean  @default(false)
  target      String?
  featureId   Int?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now()) @updatedAt
  role        UserRole
  feature     Feature? @relation(fields: [featureId], references: [id])
  plans       Plan[]   @relation("SidebarItemPlans")

  @@index([featureId], map: "SidebarItem_featureId_fkey")
  @@map("SidebarItem")
}

model TenantApplication {
  id                 String            @id @default(uuid())
  fullName           String            @map("full_name")
  email              String
  phone              String
  dob                DateTime
  address            String?
  employerName       String?           @map("employer_name")
  jobTitle           String?           @map("job_title")
  monthlyIncome      Float?            @map("monthly_income")
  employmentDuration String?           @map("employment_duration")
  leaseType          String            @map("lease_type")
  occupancyType      String            @map("occupancy_type")
  moveInDate         DateTime          @map("move_in_date")
  leaseDuration      String            @map("lease_duration")
  occupants          Int?
  pets               String?
  landlordName       String?           @map("landlord_name")
  landlordContact    String?           @map("landlord_contact")
  reasonForMoving    String?           @map("reason_for_moving")
  referenceName      String?           @map("reference_name")
  referenceContact   String?           @map("reference_contact")
  consent            Boolean           @default(false)
  propertyId         String            @map("property_id")
  userId             String?           @map("user_id")
  status             ApplicationStatus @default(PENDING)
  createdAt          DateTime          @default(now()) @map("created_at")
  updatedAt          DateTime          @updatedAt @map("updated_at")
  unitId             String?           @map("unit_id")

  // Legacy & New Security
  ssnEncrypted String? @map("ssn_encrypted")
  /// @deprecated [SECURITY RISK]
  ssn          String?

  lease    Lease?
  property Property @relation(fields: [propertyId], references: [id])
  unit     Unit?    @relation(fields: [unitId], references: [id])
  user     User?    @relation(fields: [userId], references: [id])

  @@index([propertyId], map: "TenantApplication_propertyId_fkey")
  @@index([unitId], map: "TenantApplication_unitId_fkey")
  @@index([userId], map: "TenantApplication_userId_fkey")
  @@map("TenantApplication")
}

model Testimonial {
  id        Int      @id @default(autoincrement())
  name      String
  role      String
  image     String
  text      String
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
}

model Unit {
  id              String   @id @default(uuid())
  propertyId      String   @map("property_id")
  complexDetailId String?  @map("complex_detail_id")
  listingId       String?  @unique @map("listing_id")
  unitNumber      String   @map("unit_number")
  floorNumber     Int?     @map("floor_number")
  bedrooms        Int?
  bathrooms       Int?
  isOccupied      Boolean  @default(false) @map("is_occupied")
  rentAmount      Float?   @map("rent_amount")
  createdAt       DateTime @default(now()) @map("created_at")
  houseDetailId   String?  @map("house_detail_id")
  unitName        String?  @map("unit_name")
  currency        String?  @map("currency") @db.VarChar(10)

  leases              Lease[]
  maintenanceRequests    MaintenanceRequest[]
  tenantApplications  TenantApplication[]
  listing             Listing?             @relation("UnitListing", fields: [listingId], references: [id])
  property            Property             @relation(fields: [propertyId], references: [id])
  dssDocuments        DssDocument[]
  appliances          Appliance[]          @relation("UnitAppliances")

  @@index([propertyId], map: "Unit_propertyId_fkey")
  @@map("Unit")
}

model DssNotaryRecord {
  id              String                 @id @default(uuid())
  organizationId  String                 @map("organization_id")
  documentId      String                 @unique @map("document_id")
  chainId         Int                    @map("chain_id")
  contractAddress String                 @map("contract_address")
  notarizedHash   String                 @map("notarized_hash")
  txHash          String?                @map("tx_hash")
  blockNumber     Int?                   @map("block_number")
  status          BlockchainNotaryStatus @default(PENDING)
  createdAt       DateTime               @default(now()) @map("created_at")
  confirmedAt     DateTime?              @map("confirmed_at")

  document     DssDocument  @relation(fields: [documentId], references: [id], onDelete: Cascade)
  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([notarizedHash])
  @@index([organizationId], map: "DssNotaryRecord_organization_id_fkey")
  @@map("DssNotaryRecord")
}

model DssDocument {
  id                   String            @id @default(uuid())
  organizationId       String            @map("organization_id")
  leaseId              String?           @map("lease_id")
  propertyId           String?           @map("property_id")
  unitId               String?           @map("unit_id")
  title                String
  description          String?           @db.Text
  originalFileUrl      String?           @map("original_file_url") @db.Text
  originalFileKey      String?           @map("original_file_key")
  mimeType             String?           @map("mime_type")
  fileSizeBytes        Int?              @map("file_size_bytes")
  originalPdfSha256Hex String            @map("original_pdf_sha256_hex")
  finalPdfSha256Hex    String?           @map("final_pdf_sha256_hex")
  status               DssDocumentStatus @default(DRAFT)
  signingMode          DssSigningMode    @default(SEQUENTIAL)
  currentStep          Int               @default(1) @map("current_step")
  sentAt               DateTime?         @map("sent_at")
  completedAt          DateTime?         @map("completed_at")
  voidedAt             DateTime?         @map("voided_at")
  createdAt            DateTime          @default(now()) @map("created_at")
  updatedAt            DateTime          @updatedAt @map("updated_at")

  notaryRecord  DssNotaryRecord?
  lease         Lease?            @relation(fields: [leaseId], references: [id])
  organization  Organization      @relation(fields: [organizationId], references: [id])
  property      Property?         @relation(fields: [propertyId], references: [id])
  unit          Unit?             @relation(fields: [unitId], references: [id])
  participants  DssParticipant[]
  signatures    DssSignature[]
  workflowSteps DssWorkflowStep[]

  @@index([leaseId], map: "DssDocument_lease_id_fkey")
  @@index([organizationId], map: "DssDocument_organization_id_fkey")
  @@index([propertyId], map: "DssDocument_property_id_fkey")
  @@index([unitId], map: "DssDocument_unit_id_fkey")
  @@map("DssDocument")
}

model DssParticipant {
  id             String             @id @default(uuid())
  documentId     String             @map("document_id")
  organizationId String             @map("organization_id")
  userId         String?            @map("user_id")
  role           DssParticipantRole
  email          String
  name           String?            @map("full_name") // Renamed from full_name to name, but keeping map for existing column
  signingOrder   Int                @map("signing_order")
  hasSigned      Boolean            @default(false) @map("has_signed")
  signedAt       DateTime?          @map("signed_at")
  inviteToken    String?            @unique @map("invite_token")

  document     DssDocument    @relation(fields: [documentId], references: [id], onDelete: Cascade)
  organization Organization   @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user         User?          @relation(fields: [userId], references: [id])
  signatures   DssSignature[]

  @@unique([documentId, email], map: "uq_dss_participant_doc_email")
  @@index([documentId], map: "DssParticipant_document_id_fkey")
  @@index([organizationId], map: "DssParticipant_organization_id_fkey")
  @@index([userId], map: "DssParticipant_user_id_fkey")
  @@map("DssParticipant")
}

model DssSignature {
  id            String   @id @default(uuid())
  documentId    String   @map("document_id")
  participantId String   @map("participant_id")
  signatureHash String   @map("signature_hash")
  signatureData Json?    @map("signature_data")
  signedAt      DateTime @default(now()) @map("signed_at")
  ipAddress     String?  @map("ip_address")
  userAgent     String?  @map("user_agent")

  document    DssDocument    @relation(fields: [documentId], references: [id], onDelete: Cascade)
  participant DssParticipant @relation(fields: [participantId], references: [id], onDelete: Cascade)

  @@unique([documentId, participantId], map: "uq_dss_signature_doc_participant")
  @@index([documentId], map: "DssSignature_document_id_fkey")
  @@index([participantId], map: "DssSignature_participant_id_fkey")
  @@map("DssSignature")
}

model DssWorkflowStep {
  id          String             @id @default(uuid())
  documentId  String             @map("document_id")
  stepNumber  Int                @map("step_number")
  role        DssParticipantRole
  description String?            @db.Text
  isCompleted Boolean            @default(false) @map("is_completed")
  completedAt DateTime?          @map("completed_at")

  document DssDocument @relation(fields: [documentId], references: [id], onDelete: Cascade)

  @@index([documentId], map: "dss_workflow_steps_document_id_fkey")
  @@map("dss_workflow_steps")
}

model DssWorkflowTemplate {
  id             String   @id @default(uuid())
  organizationId String   @map("organization_id")
  propertyId     String?  @map("property_id")
  name           String
  description    String?  @db.Text
  structure      Json
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  property     Property?    @relation(fields: [propertyId], references: [id])

  @@index([organizationId], map: "DssWorkflowTemplate_organization_id_fkey")
  @@index([propertyId], map: "DssWorkflowTemplate_property_id_fkey")
  @@map("DssWorkflowTemplate")
}

model Invoice {
  id        String        @id @default(dbgenerated("(uuid())")) @map("id") @db.Char(36)
  leaseId   String        @map("lease_id")
  type      InvoiceType
  amount    Float         @db.Float
  dueDate   DateTime      @map("dueDate") @db.DateTime(0)
  status    InvoiceStatus @default(PENDING)
  createdAt DateTime?     @default(now()) @map("createdAt") @db.DateTime(0)
  updatedAt DateTime?     @default(now()) @map("updatedAt") @db.DateTime(0)

  invoiceItems InvoiceItem[]
  lease        Lease         @relation(fields: [leaseId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "invoice_ibfk_1")
  payments     Payment[]
  receipts     Receipt[]

  @@index([leaseId], map: "lease_id")
  @@map("invoice")
}

model LeaseUtility {
  id                  String           @id @default(dbgenerated("(uuid())")) @db.Char(36)
  leaseId             String           @map("lease_id")
  utilityId           String           @map("utility_id") @db.Char(36)
  isTenantResponsible Boolean?         @default(true) @map("is_tenant_responsible")
  createdAt           DateTime?        @default(now()) @db.DateTime(0)
  updatedAt           DateTime?        @default(now()) @db.DateTime(0)
  lease               Lease            @relation(fields: [leaseId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "lease_utility_ibfk_1")
  utility             Utility          @relation(fields: [utilityId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "lease_utility_ibfk_2")
  utilityReadings     UtilityReading[]

  @@index([leaseId], map: "lease_id")
  @@index([utilityId], map: "utility_id")
  @@map("lease_utility")
}

model UtilityReading {
  id             String       @id @default(dbgenerated("(uuid())")) @db.Char(36)
  leaseUtilityId String       @map("lease_utility_id") @db.Char(36)
  readingValue   Float        @map("reading_value") @db.Float
  readingDate    DateTime?    @default(now()) @db.DateTime(0)
  amount         Float?       @db.Float
  createdAt      DateTime?    @default(now()) @db.DateTime(0)
  updatedAt      DateTime?    @default(now()) @db.DateTime(0)
  leaseUtility   LeaseUtility @relation(fields: [leaseUtilityId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "utility_reading_ibfk_1")

  @@index([leaseUtilityId], map: "lease_utility_id")
  @@map("utility_reading")
}

model OrganizationUser {
  id             String   @id @default(uuid())
  userId         String   @map("user_id")
  organizationId String   @map("organization_id")
  role           UserRole
  createdAt      DateTime @default(now()) @map("created_at")

  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  adminActionsByAdmin  AdminAction[]        @relation("AdminAction_adminOrgUserIdToOrganizationUser")
  adminActionsAsTarget AdminAction[]        @relation("AdminAction_targetOrgUserIdToOrganizationUser")
  MaintenanceRequest   MaintenanceRequest[] @relation("RequestCreator")
  Property             Property[]
  ServiceMarketplace   ServiceMarketplace[]

  @@unique([userId, organizationId])
  @@index([organizationId], map: "organization_users_organization_id_fkey")
  @@map("organization_users")
}

model Organization {
  id        String   @id @default(uuid())
  name      String
  slug      String   @unique
  logoUrl   String?  @map("logo_url")
  website   String?
  phone     String?
  address   String?
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  planId    Int?     @map("planId")

  plan                 Plan?                 @relation(fields: [planId], references: [id])
  invites              Invite[]
  listings             Listing[]
  maintenanceRequests  MaintenanceRequest[]
  properties           Property[]            @relation("OrganizationToProperty")
  users                OrganizationUser[]
  vendors              Vendor[]
  dssDocuments         DssDocument[]
  dssParticipants      DssParticipant[]
  dssNotaryRecords     DssNotaryRecord[]
  dssWorkflowTemplates DssWorkflowTemplate[]

  @@index([planId], map: "Organization_planId_fkey")
  @@map("organizations")
}

model Payment {
  id             String        @id @default(dbgenerated("(uuid())")) @db.Char(36)
  invoiceId      String        @map("invoice_id") @db.Char(36)
  amount         Float         @db.Float
  method         PaymentMethod
  reference      String?       @db.VarChar(100)
  paidOn         DateTime?     @default(now()) @db.DateTime(0)
  createdAt      DateTime?     @default(now()) @db.DateTime(0)
  updatedAt      DateTime?     @default(now()) @db.DateTime(0)
  isReversed     Boolean       @default(false) @map("is_reversed")
  reversedAt     DateTime?     @map("reversed_at") @db.DateTime(0)
  reversalReason String?       @map("reversal_reason") @db.VarChar(255)
  reversedBy     String?       @map("reversed_by") @db.VarChar(100)

  invoice          Invoice           @relation(fields: [invoiceId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "payment_ibfk_1")
  paymentReversals PaymentReversal[]
  receipts         Receipt[]

  @@index([invoiceId], map: "invoice_id")
  @@map("payment")
}

model PaymentReversal {
  id         String   @id @db.Char(36)
  paymentId  String   @map("payment_id") @db.Char(36)
  invoiceId  String   @map("invoice_id") @db.Char(36)
  amount     Float    @db.Float
  reason     String?  @db.VarChar(255)
  createdAt  DateTime @default(now()) @map("created_at") @db.DateTime(0)
  reversedBy String?  @map("reversed_by") @db.VarChar(100)
  metadata   Json?

  payment Payment @relation(fields: [paymentId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_reversal_payment")

  @@index([paymentId], map: "idx_payment_id")
  @@map("payment_reversal")
}

model Receipt {
  id        String    @id @default(dbgenerated("(uuid())")) @db.Char(36)
  invoiceId String    @map("invoice_id") @db.Char(36)
  paymentId String    @map("payment_id") @db.Char(36)
  receiptNo String    @unique(map: "receipt_no") @map("receipt_no") @db.VarChar(100)
  issuedOn  DateTime? @default(now()) @db.DateTime(0)
  createdAt DateTime? @default(now()) @db.DateTime(0)
  updatedAt DateTime? @default(now()) @db.DateTime(0)

  invoice Invoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "receipt_ibfk_1")
  payment Payment @relation(fields: [paymentId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "receipt_ibfk_2")

  @@index([invoiceId], map: "invoice_id")
  @@index([paymentId], map: "payment_id")
  @@map("receipt")
}

model Category {
  id       Int       @id @default(autoincrement())
  name     String
  tagline  String
  color    String
  services Service[]

  @@map("categories")
}

model Service {
  id          Int      @id @default(autoincrement())
  categoryId  Int      @map("category_id")
  name        String
  description String   @db.Text
  features    Json
  impact      String
  icon        String
  category    Category @relation(fields: [categoryId], references: [id])

  @@index([categoryId], map: "services_category_id_fkey")
  @@map("services")
}

model User {
  id                   String     @id @default(uuid())
  email                String     @unique
  passwordHash         String     @map("password_hash")
  firstName            String?    @map("first_name")
  lastName             String?    @map("last_name")
  phone                String?
  avatarUrl            String?    @map("avatar_url")
  status               UserStatus @default(ACTIVE)
  lastLoginAt          DateTime?  @map("last_login_at")
  createdAt            DateTime   @default(now()) @map("created_at")
  updatedAt            DateTime   @updatedAt @map("updated_at")
  emailVerified        DateTime?  @map("email_verified")
  verificationToken    String?    @unique @map("verificationToken")
  consentMarketing     Boolean    @default(false)
  consentNotifications Boolean    @default(true)
  consentTransactional Boolean    @default(true)

  invitesSent         Invite[]
  leases              Lease[]
  listings            Listing[]
  passwordResetTokens PasswordResetToken[]
  tenantApplications  TenantApplication[]
  organizationUsers   OrganizationUser[]
  vendors             Vendor[]
  dssParticipants     DssParticipant[]

  @@map("users")
}

model Utility {
  id             String         @id @default(dbgenerated("(uuid())")) @db.Char(36)
  name           String         @unique(map: "name") @db.VarChar(100)
  type           UtilityType
  unitPrice      Float?         @db.Float
  fixedAmount    Float?         @db.Float
  createdAt      DateTime?      @default(now()) @db.DateTime(0)
  updatedAt      DateTime?      @default(now()) @db.DateTime(0)
  leaseUtilities LeaseUtility[]

  @@map("utility")
}

model Vendor {
  id             String   @id @default(uuid())
  organizationId String   @map("organization_id")
  userId         String   @map("user_id")
  companyName    String   @map("company_name")
  serviceType    String   @map("service_type")
  phone          String?
  email          String?
  isActive       Boolean  @default(true) @map("is_active")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  organization        Organization         @relation(fields: [organizationId], references: [id])
  user                User                 @relation(fields: [userId], references: [id])
  maintenanceRequests MaintenanceRequest[]

  @@unique([organizationId, userId])
  @@index([userId], map: "Vendor_user_id_fkey")
  @@map("vendors")
}

enum UserRole {
  SYSTEM_ADMIN
  PROPERTY_MANAGER
  TENANT
  VENDOR
  AGENT
  LANDLORD
  ALL
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  PENDING
}

enum InvoiceType {
  RENT
  UTILITY
}

enum UtilityType {
  FIXED
  METERED
}

enum InvoiceStatus {
  PENDING
  PAID
  OVERDUE
}

enum PaymentMethod {
  CASH
  BANK
  CREDIT_CARD
}

enum DssDocumentStatus {
  DRAFT
  SENT
  IN_SIGNING
  COMPLETED
  DECLINED
  VOIDED
  EXPIRED
}

enum DssSigningMode {
  SEQUENTIAL
  PARALLEL
}

enum DssParticipantRole {
  LANDLORD
  TENANT
  PROPERTY_MANAGER
  AGENT
  VENDOR
  WITNESS
  NOTARY
  OTHER
}

enum BlockchainNotaryStatus {
  PENDING
  SUBMITTED
  CONFIRMED
  FAILED
}

enum ApplicationStatus {
  PENDING
  APPROVED
  REJECTED
  UNDER_REVIEW
}

enum LeaseAmendmentType {
  RENT_CHANGE
  TERM_EXTENSION
  UTILITY_CHANGE
  RESPONSIBILITY_CHANGE
  TENANT_CHANGE
  OTHER
}

enum LeaseDocumentType {
  LEASE_AGREEMENT
  ADDENDUM
  AMENDMENT
  RENEWAL_NOTICE
  TERMINATION_NOTICE
  INSPECTION_REPORT
  PROOF_OF_INSURANCE
  OTHER
}

enum LeaseNotificationType {
  RENEWAL_REMINDER
  EXPIRY_WARNING
  RENT_DUE
  LATE_PAYMENT
  ESCALATION_NOTICE
  COMPLIANCE_CHECK
  DOCUMENT_REQUIRED
  MAINTENANCE_SCHEDULED
  LEASE_SIGNED
  CUSTOM
  AMENDMENT_PROPOSED
  AMENDMENT_EXECUTED
}

enum LeaseRenewalType {
  AUTO
  MANUAL
  RENEGOTIATED
}

enum RentEscalationType {
  FIXED
  PERCENTAGE
  INDEX
  MARKET
}

enum MaintenancePriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum MaintenanceStatus {
  OPEN
  IN_PROGRESS
  ON_HOLD
  COMPLETED
  CANCELLED
  REJECTED
}

enum MaintenanceCategory {
  EMERGENCY
  URGENT
  ROUTINE
  STANDARD
}

enum LeaseStatus {
  DRAFT
  PENDING_APPROVAL
  APPROVED
  SIGNED
  ACTIVE
  EXPIRING_SOON
  EXPIRED
  TERMINATED
  RENEWED
}

enum LeaseComplianceStatus {
  PENDING
  APPROVED
  FAILED
  COMPLIANT
  NON_COMPLIANT
  UNDER_REVIEW
}

enum LeaseAmendmentStatus {
  PENDING
  APPROVED
  REJECTED
  EXECUTED
}

enum LeaseRenewalStatus {
  PENDING
  NOTICE_SENT
  TENANT_RESPONDED
  NEGOTIATING
  APPROVED
  EXECUTED
  DECLINED
}

enum TenantResponse {
  ACCEPT
  DECLINE
  NEGOTIATE
  NO_RESPONSE
}

enum LeaseNotificationStatus {
  PENDING
  SENT
  FAILED
  CANCELLED
}
