generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Organization {
  id                  String               @id @default(uuid())
  name                String
  slug                String               @unique
  logoUrl             String?              @map("logo_url")
  website             String?
  phone               String?
  address             String?
  isActive            Boolean              @default(true) @map("is_active")
  createdAt           DateTime             @default(now()) @map("created_at")
  updatedAt           DateTime             @updatedAt @map("updated_at")
  planId              Int?
  invites             Invite[]
  listings            Listing[]
  maintenanceRequests MaintenanceRequest[]
  properties          Property[]           @relation("OrganizationToProperty")
  users               OrganizationUser[]
  plan                Plan?                @relation(fields: [planId], references: [id])
  vendors             Vendor[]

  @@index([planId], map: "organizations_planId_fkey")
  @@map("organizations")
}

model User {
  id                 String              @id @default(uuid())
  email              String              @unique
  passwordHash       String              @map("password_hash")
  emailVerified      Boolean             @default(false) @map("email_verified")
  firstName          String?             @map("first_name")
  lastName           String?             @map("last_name")
  phone              String?
  avatarUrl          String?             @map("avatar_url")
  status             UserStatus          @default(ACTIVE)
  lastLoginAt        DateTime?           @map("last_login_at")
  createdAt          DateTime            @default(now()) @map("created_at")
  updatedAt          DateTime            @updatedAt @map("updated_at")
  sentInvites        Invite[]            @relation("UserInvites")
  leases             Lease[]
  listings           Listing[]
  tenantApplications Tenantapplication[]
  organizationUsers  OrganizationUser[]
  vendors            Vendor[]

  @@map("users")
}

model OrganizationUser {
  id                String               @id @default(uuid())
  userId            String               @map("user_id")
  organizationId    String               @map("organization_id")
  role              UserRole
  createdAt         DateTime             @default(now()) @map("created_at")
  adminActions      AdminAction[]        @relation("AdminActionsByAdmin")
  targetActions     AdminAction[]        @relation("AdminActionsTarget")
  createdRequests   MaintenanceRequest[] @relation("RequestCreator")
  managedProperties Property[]
  postedServices    ServiceMarketplace[]
  organization      Organization         @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user              User                 @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, organizationId])
  @@index([organizationId], map: "organization_users_organization_id_fkey")
  @@map("organization_users")
}

model Vendor {
  id             String       @id @default(uuid())
  organizationId String       @map("organization_id")
  userId         String       @map("user_id")
  companyName    String       @map("company_name")
  serviceType    String       @map("service_type")
  phone          String?
  email          String?
  isActive       Boolean      @default(true) @map("is_active")
  createdAt      DateTime     @default(now()) @map("created_at")
  updatedAt      DateTime     @updatedAt @map("updated_at")
  organization   Organization @relation(fields: [organizationId], references: [id])
  user           User         @relation(fields: [userId], references: [id])

  @@unique([organizationId, userId])
  @@index([userId], map: "vendors_user_id_fkey")
  @@map("vendors")
}

model CategoryMarketplace {
  id          String   @id @default(uuid())
  name        String   @unique
  description String?
  createdAt   DateTime @default(now())
}

model Location {
  id         String     @id @default(uuid())
  name       String
  city       String?
  country    String?
  createdAt  DateTime   @default(now())
  listings   Listing[]
  properties Property[]
}

model ActionType {
  id           String        @id @default(uuid())
  name         String        @unique
  description  String?
  createdAt    DateTime      @default(now())
  adminActions AdminAction[]
}

model Plan {
  id            Int            @id @default(autoincrement())
  name          String
  badge         String?
  monthlyPrice  Float
  yearlyPrice   Float
  description   String?
  gradient      String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime?      @default(now())
  organizations Organization[]
  features      Feature[]      @relation("PlanFeatures")
  sidebarItems  SidebarItem[]  @relation("SidebarItemPlans")
}

model Feature {
  id           Int           @id @default(autoincrement())
  title        String
  description  String?
  category     String?
  createdAt    DateTime      @default(now())
  icon         String?
  isActive     Boolean       @default(true)
  key          String?       @unique
  path         String?
  updatedAt    DateTime?     @default(now())
  sidebarItems SidebarItem[]
  plans        Plan[]        @relation("PlanFeatures")
}

model SidebarItem {
  id          Int      @id @default(autoincrement())
  label       String
  path        String
  icon        String?
  section     String?
  order       Int?
  badge       String?
  description String?
  isActive    Boolean  @default(true)
  isExternal  Boolean  @default(false)
  target      String?
  featureId   Int?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  role        UserRole
  feature     Feature? @relation(fields: [featureId], references: [id])
  plans       Plan[]   @relation("SidebarItemPlans")

  @@index([featureId], map: "SidebarItem_featureId_fkey")
}

model AboutUs {
  id          Int      @id @default(autoincrement())
  section     String
  description String   @db.Text
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now())
}

model Applicant {
  id          Int           @id @default(autoincrement())
  firstName   String
  lastName    String
  email       String        @unique
  resume      String?
  createdAt   DateTime      @default(now())
  Application Application[]
}

model Application {
  id          Int       @id @default(autoincrement())
  jobId       Int
  applicantId Int
  status      String    @default("Pending")
  appliedAt   DateTime  @default(now())
  Applicant   Applicant @relation(fields: [applicantId], references: [id])
  Job         Job       @relation(fields: [jobId], references: [id])

  @@index([applicantId], map: "Application_applicantId_fkey")
  @@index([jobId], map: "Application_jobId_fkey")
}

model CTA {
  id         Int      @id @default(autoincrement())
  page       String
  title      String
  subtitle   String
  buttonText String
  buttonUrl  String
  gradient   String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime
}

model ContactMessage {
  id          Int      @id @default(autoincrement())
  name        String
  email       String
  message     String
  createdAt   DateTime @default(now())
  countryCode String
  phone       String
}

model HeroSection {
  id          Int      @id @default(autoincrement())
  page        String
  title       String?
  subtitle    String?
  description String?
  buttonText  String?
  buttonUrl   String?
  imageUrl    String?
  iconUrl     String?
  searchBar   Boolean  @default(false)
  gradient    String?
  layout      String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime
}

model Job {
  id          Int           @id @default(autoincrement())
  title       String
  description String
  image       String
  createdAt   DateTime      @default(now())
  updatedAt   DateTime
  Application Application[]
}

model Policy {
  id                       Int       @id @default(autoincrement())
  title                    String
  companyName              String
  contactEmail             String
  privacyEmail             String
  website                  String?
  mailingAddress           String?
  responseTime             String?
  inactiveAccountThreshold String?
  createdAt                DateTime  @default(now())
  updatedAt                DateTime
  Section                  Section[]
}

model Section {
  id        Int      @id @default(autoincrement())
  key       String
  title     String
  intro     String?
  content   Json?
  order     Int?
  policyId  Int
  createdAt DateTime @default(now())
  updatedAt DateTime
  Policy    Policy   @relation(fields: [policyId], references: [id])

  @@index([policyId], map: "Section_policyId_fkey")
}

model Testimonial {
  id        Int      @id @default(autoincrement())
  name      String
  role      String
  image     String
  text      String
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
}

model categories {
  id       Int        @id @default(autoincrement())
  name     String
  tagline  String
  color    String
  services services[]
}

model services {
  id          Int        @id @default(autoincrement())
  category_id Int
  name        String
  description String
  features    Json
  impact      String
  icon        String
  categories  categories @relation(fields: [category_id], references: [id])

  @@index([category_id], map: "services_category_id_fkey")
}

model MaintenanceRequest {
  id             String           @id @default(uuid())
  organizationId String
  propertyId     String
  requestedById  String
  title          String
  description    String
  priority       Priority         @default(NORMAL)
  status         RequestStatus    @default(OPEN)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  category       RequestCategory  @default(STANDARD)
  unitId         String?
  organization   Organization     @relation(fields: [organizationId], references: [id])
  property       Property         @relation("PropertyMaintenanceRequests", fields: [propertyId], references: [id])
  requestedBy    OrganizationUser @relation("RequestCreator", fields: [requestedById], references: [id])
  unit           Unit?            @relation(fields: [unitId], references: [id])

  @@index([organizationId], map: "MaintenanceRequest_organizationId_fkey")
  @@index([propertyId], map: "MaintenanceRequest_propertyId_fkey")
  @@index([requestedById], map: "MaintenanceRequest_requestedById_fkey")
  @@index([unitId], map: "MaintenanceRequest_unitId_fkey")
}

model ListingStatus {
  id          String    @id @default(uuid())
  name        String    @unique
  description String?
  createdAt   DateTime  @default(now())
  listings    Listing[]
}

model PropertyType {
  id          String     @id @default(uuid())
  name        String     @unique
  description String?
  createdAt   DateTime   @default(now())
  properties  Property[]
}

model ServiceType {
  id                 String               @id @default(uuid())
  name               String               @unique
  description        String?
  createdAt          DateTime             @default(now())
  serviceMarketplace ServiceMarketplace[]
}

model Listing {
  id                 String              @id @default(uuid())
  organizationId     String
  createdBy          String
  statusId           String?
  locationId         String?
  title              String
  description        String
  price              Float
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  propertyId         String?
  unitId             String?
  adminActions       AdminAction[]
  createdByUser      User                @relation(fields: [createdBy], references: [id])
  location           Location?           @relation(fields: [locationId], references: [id])
  organization       Organization        @relation(fields: [organizationId], references: [id])
  status             ListingStatus?      @relation(fields: [statusId], references: [id])
  images             ListingImage[]
  property           Property?           @relation("PropertyListing")
  serviceMarketplace ServiceMarketplace?
  unit               Unit?               @relation("UnitListing")

  @@index([createdBy], map: "Listing_createdBy_fkey")
  @@index([locationId], map: "Listing_locationId_fkey")
  @@index([organizationId], map: "Listing_organizationId_fkey")
  @@index([statusId], map: "Listing_statusId_fkey")
}

model Property {
  id                     String                  @id @default(uuid())
  listingId              String?                 @unique
  managerId              String?
  organizationId         String?
  propertyTypeId         String?
  locationId             String?
  city                   String
  address                String
  amenities              String?
  isFurnished            Boolean                 @default(false)
  availabilityStatus     String?
  createdAt              DateTime                @default(now())
  name                   String?
  apartmentComplexDetail ApartmentComplexDetail?
  houseDetail            HouseDetail?
  leases                 Lease[]
  maintenanceRequests    MaintenanceRequest[]    @relation("PropertyMaintenanceRequests")
  listing                Listing?                @relation("PropertyListing", fields: [listingId], references: [id])
  location               Location?               @relation(fields: [locationId], references: [id])
  manager                OrganizationUser?       @relation(fields: [managerId], references: [id])
  organization           Organization?           @relation("OrganizationToProperty", fields: [organizationId], references: [id])
  propertyType           PropertyType?           @relation(fields: [propertyTypeId], references: [id])
  tenantapplications     Tenantapplication[]
  units                  Unit[]

  @@index([locationId], map: "Property_locationId_fkey")
  @@index([managerId], map: "Property_managerId_fkey")
  @@index([organizationId], map: "Property_organizationId_fkey")
  @@index([propertyTypeId], map: "Property_propertyTypeId_fkey")
}

model ApartmentComplexDetail {
  id           String   @id @default(uuid())
  propertyId   String   @unique
  buildingName String?
  totalFloors  Int?
  totalUnits   Int?
  property     Property @relation(fields: [propertyId], references: [id])
}

model HouseDetail {
  id             String   @id @default(uuid())
  propertyId     String   @unique
  numberOfFloors Int?
  bathrooms      Int?
  bedrooms       Int?
  size           Float?
  totalUnits     Int?
  property       Property @relation(fields: [propertyId], references: [id])
}

model Unit {
  id                  String               @id @default(uuid())
  propertyId          String
  complexDetailId     String?
  listingId           String?              @unique
  unitNumber          String
  floorNumber         Int?
  bedrooms            Int?
  bathrooms           Int?
  isOccupied          Boolean              @default(false)
  rentAmount          Float?
  createdAt           DateTime             @default(now())
  houseDetailId       String?
  unitName            String?
  currency            String?              @db.VarChar(10)
  leases              Lease[]
  maintenanceRequests MaintenanceRequest[]
  tenantApplications  Tenantapplication[]
  listing             Listing?             @relation("UnitListing", fields: [listingId], references: [id])
  property            Property             @relation(fields: [propertyId], references: [id])
  appliances          Appliance[]          @relation("UnitAppliances")

  @@index([propertyId], map: "Unit_propertyId_fkey")
}

model Appliance {
  id          String   @id @default(uuid())
  createdAt   DateTime @default(now())
  description String?
  name        String
  units       Unit[]   @relation("UnitAppliances")
}

model ServiceMarketplace {
  id            String            @id @default(uuid())
  listingId     String            @unique
  vendorId      String?
  serviceTypeId String?
  description   String
  rate          Float
  availability  String?
  createdAt     DateTime          @default(now())
  listing       Listing           @relation(fields: [listingId], references: [id])
  serviceType   ServiceType?      @relation(fields: [serviceTypeId], references: [id])
  vendor        OrganizationUser? @relation(fields: [vendorId], references: [id])

  @@index([serviceTypeId], map: "ServiceMarketplace_serviceTypeId_fkey")
  @@index([vendorId], map: "ServiceMarketplace_vendorId_fkey")
}

model ListingImage {
  id        String   @id @default(uuid())
  listingId String
  imageUrl  String
  isPrimary Boolean  @default(false)
  createdAt DateTime @default(now())
  listing   Listing  @relation(fields: [listingId], references: [id])

  @@index([listingId], map: "ListingImage_listingId_fkey")
}

model AdminAction {
  id              String            @id @default(uuid())
  adminOrgUserId  String
  targetOrgUserId String?
  listingId       String?
  actionTypeId    String
  reason          String?
  details         Json?
  createdAt       DateTime          @default(now())
  actionType      ActionType        @relation(fields: [actionTypeId], references: [id])
  admin           OrganizationUser  @relation("AdminActionsByAdmin", fields: [adminOrgUserId], references: [id])
  listing         Listing?          @relation(fields: [listingId], references: [id])
  target          OrganizationUser? @relation("AdminActionsTarget", fields: [targetOrgUserId], references: [id])

  @@index([actionTypeId], map: "AdminAction_actionTypeId_fkey")
  @@index([adminOrgUserId], map: "AdminAction_adminOrgUserId_fkey")
  @@index([listingId], map: "AdminAction_listingId_fkey")
  @@index([targetOrgUserId], map: "AdminAction_targetOrgUserId_fkey")
}

model NavbarItem {
  id          Int          @id @default(autoincrement())
  name        String
  href        String
  order       Int          @default(0)
  isVisible   Boolean      @default(true)
  isAvailable Boolean      @default(true)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  parentId    Int?
  parent      NavbarItem?  @relation("NavbarSubmenu", fields: [parentId], references: [id], onDelete: Cascade)
  children    NavbarItem[] @relation("NavbarSubmenu")

  @@index([parentId])
  @@index([order])
}

model Invite {
  id             String       @id @default(cuid())
  email          String
  token          String       @unique
  role           UserRole
  organizationId String
  invitedById    String?
  expiresAt      DateTime
  accepted       Boolean      @default(false)
  createdAt      DateTime     @default(now())
  leaseId        String?      @db.VarChar(255)
  lease          Lease?       @relation("LeaseInvites", fields: [leaseId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "FK_Invite_Lease")
  invitedBy      User?        @relation("UserInvites", fields: [invitedById], references: [id])
  organization   Organization @relation(fields: [organizationId], references: [id])

  @@index([organizationId])
  @@index([email])
  @@index([invitedById], map: "Invite_invitedById_fkey")
  @@index([leaseId], map: "idx_invite_leaseId")
}

model Tenantapplication {
  id                 String            @id @default(uuid())
  fullName           String
  email              String
  phone              String
  dob                DateTime
  ssn                String?
  address            String?
  employerName       String?
  jobTitle           String?
  monthlyIncome      Float?
  employmentDuration String?
  leaseType          String
  occupancyType      String
  moveInDate         DateTime
  leaseDuration      String
  occupants          Int?
  pets               String?
  landlordName       String?
  landlordContact    String?
  reasonForMoving    String?
  referenceName      String?
  referenceContact   String?
  consent            Boolean           @default(false)
  propertyId         String
  userId             String?
  status             ApplicationStatus @default(PENDING)
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt
  unitId             String?
  tenantLeases       Lease?
  property           Property          @relation(fields: [propertyId], references: [id])
  unit               Unit?             @relation(fields: [unitId], references: [id])
  user               User?             @relation(fields: [userId], references: [id])

  @@index([propertyId], map: "Tenantapplication_propertyId_fkey")
  @@index([userId], map: "Tenantapplication_userId_fkey")
  @@index([unitId], map: "Tenantapplication_unitId_fkey")
}

model Lease {
  id                       String            @id @default(uuid())
  applicationId            String            @unique
  tenantId                 String?
  propertyId               String
  unitId                   String
  startDate                DateTime
  endDate                  DateTime
  rentAmount               Float
  securityDeposit          Float?
  leaseStatus              LeaseStatus       @default(DRAFT)
  createdAt                DateTime          @default(now())
  updatedAt                DateTime          @updatedAt
  earlyTerminationFee      Float?
  gracePeriodDays          Int?
  landlordResponsibilities String?
  landlordSignedAt         DateTime?
  lateFeeDaily             Float?
  lateFeeFlat              Float?
  leaseTerm                String?
  paymentDueDay            Int?
  paymentFrequency         String            @default("MONTHLY")
  tenantPaysElectric       Boolean           @default(true)
  tenantPaysInternet       Boolean           @default(false)
  tenantPaysTrash          Boolean           @default(false)
  tenantPaysWater          Boolean           @default(false)
  tenantResponsibilities   String?
  tenantSignedAt           DateTime?
  terminationNoticeDays    Int?
  usageType                String?
  invites                  Invite[]          @relation("LeaseInvites")
  application              Tenantapplication @relation(fields: [applicationId], references: [id])
  property                 Property          @relation(fields: [propertyId], references: [id])
  tenant                   User?             @relation(fields: [tenantId], references: [id])
  unit                     Unit              @relation(fields: [unitId], references: [id])
  invoice                  invoice[]
  lease_utility            lease_utility[]

  @@index([propertyId], map: "Lease_propertyId_fkey")
  @@index([tenantId], map: "Lease_tenantId_fkey")
  @@index([unitId], map: "Lease_unitId_fkey")
}

model invoice {
  id        String          @id @default(dbgenerated("(uuid())")) @db.Char(36)
  lease_id  String
  type      invoice_type
  amount    Float           @db.Float
  dueDate   DateTime        @db.DateTime(0)
  status    invoice_status? @default(PENDING)
  createdAt DateTime?       @default(now()) @db.DateTime(0)
  updatedAt DateTime?       @default(now()) @db.DateTime(0)
  Lease     Lease           @relation(fields: [lease_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "invoice_ibfk_1")
  payment   payment[]
  receipt   receipt[]

  @@index([lease_id], map: "lease_id")
}

model lease_utility {
  id                    String            @id @default(dbgenerated("(uuid())")) @db.Char(36)
  lease_id              String
  utility_id            String            @db.Char(36)
  is_tenant_responsible Boolean?          @default(true)
  createdAt             DateTime?         @default(now()) @db.DateTime(0)
  updatedAt             DateTime?         @default(now()) @db.DateTime(0)
  Lease                 Lease             @relation(fields: [lease_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "lease_utility_ibfk_1")
  utility               utility           @relation(fields: [utility_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "lease_utility_ibfk_2")
  utility_reading       utility_reading[]

  @@index([lease_id], map: "lease_id")
  @@index([utility_id], map: "utility_id")
}

model payment {
  id         String         @id @default(dbgenerated("(uuid())")) @db.Char(36)
  invoice_id String         @db.Char(36)
  amount     Float          @db.Float
  method     payment_method
  reference  String?        @db.VarChar(100)
  paidOn     DateTime?      @default(now()) @db.DateTime(0)
  createdAt  DateTime?      @default(now()) @db.DateTime(0)
  updatedAt  DateTime?      @default(now()) @db.DateTime(0)
  invoice    invoice        @relation(fields: [invoice_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "payment_ibfk_1")
  receipt    receipt[]

  @@index([invoice_id], map: "invoice_id")
}

model receipt {
  id         String    @id @default(dbgenerated("(uuid())")) @db.Char(36)
  invoice_id String    @db.Char(36)
  payment_id String    @db.Char(36)
  receiptNo  String    @unique(map: "receiptNo") @db.VarChar(100)
  issuedOn   DateTime? @default(now()) @db.DateTime(0)
  createdAt  DateTime? @default(now()) @db.DateTime(0)
  updatedAt  DateTime? @default(now()) @db.DateTime(0)
  invoice    invoice   @relation(fields: [invoice_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "receipt_ibfk_1")
  payment    payment   @relation(fields: [payment_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "receipt_ibfk_2")

  @@index([invoice_id], map: "invoice_id")
  @@index([payment_id], map: "payment_id")
}

model utility {
  id            String          @id @default(dbgenerated("(uuid())")) @db.Char(36)
  name          String          @unique(map: "name") @db.VarChar(100)
  type          utility_type
  unitPrice     Float?          @db.Float
  fixedAmount   Float?          @db.Float
  createdAt     DateTime?       @default(now()) @db.DateTime(0)
  updatedAt     DateTime?       @default(now()) @db.DateTime(0)
  lease_utility lease_utility[]
}

model utility_reading {
  id               String        @id @default(dbgenerated("(uuid())")) @db.Char(36)
  lease_utility_id String        @db.Char(36)
  reading_value    Float         @db.Float
  readingDate      DateTime?     @default(now()) @db.DateTime(0)
  amount           Float?        @db.Float
  createdAt        DateTime?     @default(now()) @db.DateTime(0)
  updatedAt        DateTime?     @default(now()) @db.DateTime(0)
  lease_utility    lease_utility @relation(fields: [lease_utility_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "utility_reading_ibfk_1")

  @@index([lease_utility_id], map: "lease_utility_id")
}

enum UserRole {
  SYSTEM_ADMIN
  PROPERTY_MANAGER
  TENANT
  VENDOR
  ALL
}

enum Priority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum RequestStatus {
  OPEN
  IN_PROGRESS
  ON_HOLD
  COMPLETED
  CANCELLED
}

enum RequestCategory {
  EMERGENCY
  URGENT
  ROUTINE
  STANDARD
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum ApplicationStatus {
  PENDING
  APPROVED
  REJECTED
  UNDER_REVIEW
}

enum LeaseStatus {
  DRAFT
  ACTIVE
  SIGNED
  CANCELLED
}

enum invoice_type {
  RENT
  UTILITY
}

enum utility_type {
  FIXED
  METERED
}

enum payment_method {
  CASH
  BANK
  CREDIT_CARD @map("CREDIT CARD")
}

enum invoice_status {
  PENDING
  PAID
  OVERDUE
}
